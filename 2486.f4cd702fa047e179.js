"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2486],{2486:(qt,O,h)=>{h.r(O),h.d(O,{HomePageModule:()=>Zt});var v=h(2200),x=h(4341),f=h(9893),R=h(8132),d=h(467);const B={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let T;const J=new Uint8Array(16),g=[];for(let o=0;o<256;++o)g.push((o+256).toString(16).slice(1));function Z(o,n,s){const t=(o=o||{}).random??o.rng?.()??function Q(){if(!T){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");T=crypto.getRandomValues.bind(crypto)}return T(J)}();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,n){if((s=s||0)<0||s+16>n.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let i=0;i<16;++i)n[s+i]=t[i];return n}return function S(o,n=0){return(g[o[n+0]]+g[o[n+1]]+g[o[n+2]]+g[o[n+3]]+"-"+g[o[n+4]]+g[o[n+5]]+"-"+g[o[n+6]]+g[o[n+7]]+"-"+g[o[n+8]]+g[o[n+9]]+"-"+g[o[n+10]]+g[o[n+11]]+g[o[n+12]]+g[o[n+13]]+g[o[n+14]]+g[o[n+15]]).toLowerCase()}(t)}var et=h(9974),nt=h(4360),e=h(3664),p=h(2615),G=h(9330),it=h(9350),st=h(7707);function w(o,n){const s="object"==typeof n;return new Promise((t,i)=>{const r=new st.Ms({next:a=>{t(a),r.unsubscribe()},error:i,complete:()=>{s?t(n.defaultValue):i(new it.G)}});o.subscribe(r)})}var rt=h(1985),at=h(8359);class ct extends at.yU{constructor(n,s){super()}schedule(n,s=0){return this}}const I={setInterval(o,n,...s){const{delegate:t}=I;return t?.setInterval?t.setInterval(o,n,...s):setInterval(o,n,...s)},clearInterval(o){const{delegate:n}=I;return(n?.clearInterval||clearInterval)(o)},delegate:void 0};var lt=h(7908);const $={now:()=>($.delegate||Date).now(),delegate:void 0};class b{constructor(n,s=b.now){this.schedulerActionCtor=n,this.now=s}schedule(n,s=0,t){return new this.schedulerActionCtor(this,n).schedule(t,s)}}b.now=$.now;const pt=new class dt extends b{constructor(n,s=b.now){super(n,s),this.actions=[],this._active=!1}flush(n){const{actions:s}=this;if(this._active)return void s.push(n);let t;this._active=!0;do{if(t=n.execute(n.state,n.delay))break}while(n=s.shift());if(this._active=!1,t){for(;n=s.shift();)n.unsubscribe();throw t}}}(class ut extends ct{constructor(n,s){super(n,s),this.scheduler=n,this.work=s,this.pending=!1}schedule(n,s=0){var t;if(this.closed)return this;this.state=n;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,s)),this.pending=!0,this.delay=s,this.id=null!==(t=this.id)&&void 0!==t?t:this.requestAsyncId(r,this.id,s),this}requestAsyncId(n,s,t=0){return I.setInterval(n.flush.bind(n,this),t)}recycleAsyncId(n,s,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return s;null!=s&&I.clearInterval(s)}execute(n,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const t=this._execute(n,s);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,s){let i,t=!1;try{this.work(n)}catch(r){t=!0,i=r||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:n,scheduler:s}=this,{actions:t}=s;this.work=this.state=this.scheduler=null,this.pending=!1,(0,lt.o)(t,this),null!=n&&(this.id=this.recycleAsyncId(s,n,null)),this.delay=null,super.unsubscribe()}}});var ft=h(9470);var mt=h(5558);let _t=(()=>{var o;class n{constructor(t){this.http=t,this.apiBase="https://api.arting.ai/api",this.auth="150afc00-5f9e-489b-973c-802e2c67446b"}getSignedUrl(t){var i=this;return(0,d.A)(function*(){return w(i.http.post(`${i.apiBase}/cg/get_oss_signed_urls`,{f_suffixs:[t]}))})()}uploadToOss(t,i,r){var a=this;return(0,d.A)(function*(){const c=new G.Lr({"Content-Type":r});return w(a.http.put(t,i,{headers:c}))})()}initSwap(t,i,r,a,c){var l=this;return(0,d.A)(function*(){const u={authorization:a};return w("image"===t?l.http.post(`${l.apiBase}/fs/singleface`,{target_image_file:r,target_face_file:i,face_enhance:!1},{headers:u}):l.http.post(`${l.apiBase}/fs/gifvideo/mutilface`,{task_type:2,file_type:t,target_medio_url:r,target_source_face_url:i,duration:100,start_clip_sec:0,end_clip_sec:100,face_enhance:c},{headers:u}))})()}pollStatus(t,i,r){const a={authorization:r};return function gt(o=0,n,s=pt){let t=-1;return null!=n&&((0,ft.m)(n)?s=n:t=n),new rt.c(i=>{let r=function ht(o){return o instanceof Date&&!isNaN(o)}(o)?+o-s.now():o;r<0&&(r=0);let a=0;return s.schedule(function(){i.closed||(i.next(a++),0<=t?this.schedule(void 0,t):i.complete())},r)})}(0,"image"===t?5e3:1e4).pipe((0,mt.n)(()=>{if("image"===t)return this.http.get(`${this.apiBase}/fs/result?request_id=${i}`,{headers:a});{const l=new FormData;return l.append("prediction_id",i),l.append("task_type","2"),this.http.post(`${this.apiBase}/mfs/gifvideo/task/status`,l,{headers:a})}}))}static#t=o=()=>(this.\u0275fac=function(i){return new(i||n)(p.KVO(G.Qq))},this.\u0275prov=p.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}))}return o(),n})();function H(o,n){this.v=o,this.k=n}function V(o){return new H(o,0)}function k(o){var n,s;function t(r,a){try{var c=o[r](a),l=c.value,u=l instanceof H;Promise.resolve(u?l.v:l).then(function(m){if(u){var y="return"===r?"return":"next";if(!l.k||m.done)return t(y,m);m=o[y](m).value}i(c.done?"return":"normal",m)},function(m){t("throw",m)})}catch(m){i("throw",m)}}function i(r,a){switch(r){case"return":n.resolve({value:a,done:!0});break;case"throw":n.reject(a);break;default:n.resolve({value:a,done:!1})}(n=n.next)?t(n.key,n.arg):s=null}this._invoke=function(r,a){return new Promise(function(c,l){var u={key:r,arg:a,resolve:c,reject:l,next:null};s?s=s.next=u:(n=s=u,t(r,a))})},"function"!=typeof o.return&&(this.return=void 0)}k.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},k.prototype.next=function(o){return this._invoke("next",o)},k.prototype.throw=function(o){return this._invoke("throw",o)},k.prototype.return=function(o){return this._invoke("return",o)};const A=(o,n)=>n.some(s=>o instanceof s);let L,Y;const j=new WeakMap,E=new WeakMap,P=new WeakMap;let C={get(o,n,s){if(o instanceof IDBTransaction){if("done"===n)return j.get(o);if("store"===n)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return _(o[n])},set:(o,n,s)=>(o[n]=s,!0),has:(o,n)=>o instanceof IDBTransaction&&("done"===n||"store"===n)||n in o};function N(o){C=o(C)}function Pt(o){return"function"==typeof o?function It(o){return function kt(){return Y||(Y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(o)?function(...n){return o.apply(D(this),n),_(this.request)}:function(...n){return _(o.apply(D(this),n))}}(o):(o instanceof IDBTransaction&&function wt(o){if(j.has(o))return;const n=new Promise((s,t)=>{const i=()=>{o.removeEventListener("complete",r),o.removeEventListener("error",a),o.removeEventListener("abort",a)},r=()=>{s(),i()},a=()=>{t(o.error||new DOMException("AbortError","AbortError")),i()};o.addEventListener("complete",r),o.addEventListener("error",a),o.addEventListener("abort",a)});j.set(o,n)}(o),A(o,function bt(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(o,C):o)}function _(o){if(o instanceof IDBRequest)return function vt(o){const n=new Promise((s,t)=>{const i=()=>{o.removeEventListener("success",r),o.removeEventListener("error",a)},r=()=>{s(_(o.result)),i()},a=()=>{t(o.error),i()};o.addEventListener("success",r),o.addEventListener("error",a)});return P.set(n,o),n}(o);if(E.has(o))return E.get(o);const n=Pt(o);return n!==o&&(E.set(o,n),P.set(n,o)),n}const D=o=>P.get(o),Tt=["get","getKey","getAll","getAllKeys","count"],At=["put","add","delete","clear"],M=new Map;function z(o,n){if(!(o instanceof IDBDatabase)||n in o||"string"!=typeof n)return;if(M.get(n))return M.get(n);const s=n.replace(/FromIndex$/,""),t=n!==s,i=At.includes(s);if(!(s in(t?IDBIndex:IDBObjectStore).prototype)||!i&&!Tt.includes(s))return;const r=function(){var a=(0,d.A)(function*(c,...l){const u=this.transaction(c,i?"readwrite":"readonly");let m=u.store;return t&&(m=m.index(l.shift())),(yield Promise.all([m[s](...l),i&&u.done]))[0]});return function(l){return a.apply(this,arguments)}}();return M.set(n,r),r}N(o=>({...o,get:(n,s,t)=>z(n,s)||o.get(n,s,t),has:(n,s)=>!!z(n,s)||o.has(n,s)}));const jt=["continue","continuePrimaryKey","advance"],X={},U=new WeakMap,W=new WeakMap,Et={get(o,n){if(!jt.includes(n))return o[n];let s=X[n];return s||(s=X[n]=function(...t){U.set(this,W.get(this)[n](...t))}),s}};function Ct(){return F.apply(this,arguments)}function F(){return F=function yt(o){return function(){return new k(o.apply(this,arguments))}}(function*(...o){let n=this;if(n instanceof IDBCursor||(n=yield V(n.openCursor(...o))),!n)return;const s=new Proxy(n,Et);for(W.set(s,n),P.set(s,D(n));n;)yield s,n=yield V(U.get(s)||n.continue()),U.delete(s)}),F.apply(this,arguments)}function K(o,n){return n===Symbol.asyncIterator&&A(o,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&A(o,[IDBIndex,IDBObjectStore])}N(o=>({...o,get:(n,s,t)=>K(n,s)?Ct:o.get(n,s,t),has:(n,s)=>K(n,s)||o.has(n,s)}));let Dt=(()=>{var o;class n{constructor(){this.dbPromise=function xt(o,n,{blocked:s,upgrade:t,blocking:i,terminated:r}={}){const a=indexedDB.open(o,n),c=_(a);return t&&a.addEventListener("upgradeneeded",l=>{t(_(a.result),l.oldVersion,l.newVersion,_(a.transaction),l)}),s&&a.addEventListener("blocked",l=>s(l.oldVersion,l.newVersion,l)),c.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}("FaceSwapDB11",11,{upgrade(t){t.createObjectStore("faces"),t.createObjectStore("targets"),t.createObjectStore("tasks")}})}set(t,i,r){var a=this;return(0,d.A)(function*(){return(yield a.dbPromise).put(t,r,i)})()}getAll(t){var i=this;return(0,d.A)(function*(){return(yield i.dbPromise).getAll(t)})()}delete(t,i){var r=this;return(0,d.A)(function*(){return(yield r.dbPromise).delete(t,i)})()}clearStore(t){var i=this;return(0,d.A)(function*(){return(yield i.dbPromise).clear(t)})()}clearAll(){var t=this;return(0,d.A)(function*(){yield t.clearStore("faces"),yield t.clearStore("targets"),yield t.clearStore("tasks")})()}static#t=o=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275prov=p.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}))}return o(),n})();function Mt(o,n){1&o&&(e.j41(0,"div",29),e.nrm(1,"ion-icon",30),e.k0s())}function Ut(o,n){1&o&&e.nrm(0,"ion-spinner",31)}function Ft(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-col",22)(1,"div",23)(2,"ion-button",24),e.bIt("click",function(){const i=p.eBV(s).$implicit,r=e.XpG();return p.Njj(r.removeMedia(i.id,"faces"))}),e.nrm(3,"ion-icon",25),e.k0s(),e.nrm(4,"img",26),e.DNE(5,Mt,2,0,"div",27)(6,Ut,1,0,"ion-spinner",28),e.k0s()()}if(2&o){const s=n.$implicit;e.R7$(),e.AVh("upload-success","success"===s.status),e.R7$(3),e.Y8G("src",s.localUrl,e.B4B),e.R7$(),e.Y8G("ngIf","success"===s.status),e.R7$(),e.Y8G("ngIf","uploading"===s.status)}}function Ot(o,n){if(1&o&&e.nrm(0,"img",26),2&o){const s=e.XpG().$implicit;e.Y8G("src",s.localUrl,e.B4B)}}function Rt(o,n){if(1&o&&e.nrm(0,"video",37),2&o){const s=e.XpG().$implicit;e.Y8G("src",s.localUrl,e.B4B)}}function Bt(o,n){1&o&&(e.j41(0,"div",29),e.nrm(1,"ion-icon",30),e.k0s())}function St(o,n){1&o&&e.nrm(0,"ion-spinner",38)}function Gt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-col",32)(1,"div",23)(2,"ion-button",33),e.bIt("click",function(){const i=p.eBV(s).$implicit,r=e.XpG();return p.Njj(r.removeMedia(i.id,"targets"))}),e.nrm(3,"ion-icon",25),e.k0s(),e.DNE(4,Ot,1,1,"img",34)(5,Rt,1,1,"video",35)(6,Bt,2,0,"div",27)(7,St,1,0,"ion-spinner",36),e.k0s()()}if(2&o){const s=n.$implicit;e.R7$(),e.AVh("upload-success","success"===s.status),e.R7$(3),e.Y8G("ngIf","video"!==s.type),e.R7$(),e.Y8G("ngIf","video"===s.type),e.R7$(),e.Y8G("ngIf","success"===s.status),e.R7$(),e.Y8G("ngIf","uploading"===s.status)}}function $t(o,n){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const s=e.XpG();e.R7$(),e.SpI(" Start Swap (",s.faces.length*s.targets.length," combinations)\n")}}function Ht(o,n){1&o&&(e.j41(0,"span"),e.EFF(1," All Tasks Processing...\n"),e.k0s())}function Vt(o,n){1&o&&(e.j41(0,"span"),e.EFF(1," Upload Media First\n"),e.k0s())}function Lt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-button",39),e.bIt("click",function(){p.eBV(s);const i=e.XpG();return p.Njj(i.downloadAllTasks())}),e.nrm(1,"ion-icon",40),e.EFF(2," Download All "),e.k0s()}}function Yt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-button",41),e.bIt("click",function(){p.eBV(s);const i=e.XpG();return p.Njj(i.clearAllTasks())}),e.nrm(1,"ion-icon",42),e.k0s()}}function Nt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-button",52),e.bIt("click",function(){p.eBV(s);const i=e.XpG().$implicit,r=e.XpG();return p.Njj(r.retryTask(i))}),e.nrm(1,"ion-icon",53),e.k0s()}}function zt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-button",54),e.bIt("click",function(){p.eBV(s);const i=e.XpG().$implicit,r=e.XpG();return p.Njj(r.directDownload(i))}),e.nrm(1,"ion-icon",55),e.k0s()}}function Xt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-button",56),e.bIt("click",function(){p.eBV(s);const i=e.XpG().$implicit,r=e.XpG();return p.Njj(r.openUrl(i.outputUrl))}),e.nrm(1,"ion-icon",57),e.k0s()}}function Wt(o,n){1&o&&e.nrm(0,"ion-spinner",58)}function Kt(o,n){if(1&o){const s=e.RV6();e.j41(0,"ion-item")(1,"ion-thumbnail",43),e.nrm(2,"img",26),e.k0s(),e.j41(3,"ion-label")(4,"h3"),e.EFF(5),e.nI1(6,"uppercase"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Status: "),e.j41(9,"ion-badge",44),e.EFF(10),e.k0s()()(),e.j41(11,"div",45),e.DNE(12,Nt,2,0,"ion-button",46)(13,zt,2,0,"ion-button",47)(14,Xt,2,0,"ion-button",48),e.j41(15,"ion-button",49),e.bIt("click",function(){const i=p.eBV(s).$implicit,r=e.XpG();return p.Njj(r.deleteSingleTask(i.id))}),e.nrm(16,"ion-icon",50),e.k0s(),e.DNE(17,Wt,1,0,"ion-spinner",51),e.k0s()()}if(2&o){const s=n.$implicit;e.R7$(2),e.Y8G("src",s.faceUrl,e.B4B),e.R7$(3),e.SpI("Type: ",e.bMT(6,8,s.type)),e.R7$(4),e.Y8G("color","downloaded"===s.status?"secondary":"success"===s.status?"success":"warning"),e.R7$(),e.SpI(" ",s.status," "),e.R7$(2),e.Y8G("ngIf","failed"===s.status),e.R7$(),e.Y8G("ngIf","success"===s.status),e.R7$(),e.Y8G("ngIf","success"===s.status&&s.outputUrl),e.R7$(3),e.Y8G("ngIf","downloading"===s.status)}}const Jt=[{path:"",component:(()=>{var o;class n{constructor(t,i,r){this.api=t,this.storage=i,this.toastController=r,this.faces=[],this.targets=[],this.tasks=[],this.faceEnhance=!1,this.isAutomationEnabled=!0}ngOnInit(){var t=this;return(0,d.A)(function*(){const i=yield t.storage.getAll("faces"),r=yield t.storage.getAll("targets");t.faces=i.map(a=>({...a,localUrl:a.blob?URL.createObjectURL(a.blob):a.localUrl})),t.targets=r.map(a=>({...a,localUrl:a.blob?URL.createObjectURL(a.blob):a.localUrl})),t.restartPolling()})()}ionViewWillEnter(){var t=this;return(0,d.A)(function*(){yield t.loadTasks(),t.runAutomationOnLoad()})()}loadTasks(){var t=this;return(0,d.A)(function*(){const i=yield t.storage.getAll("tasks");t.tasks=i||[],console.log("Tasks loaded from storage:",t.tasks.length)})()}runAutomationOnLoad(){var t=this;return(0,d.A)(function*(){for(const i of t.tasks)("waiting"===i.status||"processing"===i.status)&&t.saveAndPoll(i),t.isAutomationEnabled&&"success"===i.status&&i.outputUrl&&t.directDownload(i)})()}handleFileSelect(t,i){var r=this;return(0,d.A)(function*(){const a=t.target.files;for(let c of a){const u={id:crypto.randomUUID(),localUrl:URL.createObjectURL(c),blob:c,type:r.getMediaType(c.type),status:"pending",f_suffix:c.name.split(".").pop()};"faces"===i?r.faces.push(u):r.targets.push(u),r.uploadFile(u,c,i)}})()}uploadFile(t,i,r){var a=this;return(0,d.A)(function*(){try{t.status="uploading";const c=yield a.api.getSignedUrl(t.f_suffix),{put:l,get:u}=c.data.oss_signed_urls[0];yield a.api.uploadToOss(l,i,i.type),t.remoteGetUrl=u,t.status="success",yield a.storage.set(r,t.id,t),a.autoStartProcessing()}catch{t.status="failed",yield a.storage.set(r,t.id,t)}})()}autoStartProcessing(){this.targets.filter(t=>"success"===t.status).forEach(t=>{this.faces.filter(i=>"success"===i.status).forEach(i=>{this.tasks.some(a=>a.faceId===i.id&&a.targetId===t.id)||this.createTask(i,t)})})}startSwapProcess(){this.targets.forEach(t=>{this.faces.forEach(i=>{t.remoteGetUrl&&i.remoteGetUrl&&this.createTask(i,t)})})}createTask(t,i){var r=this;return(0,d.A)(function*(){const a=function q(o,n,s){return!B.randomUUID||n||o?Z(o,n,s):B.randomUUID()}(),c=crypto.randomUUID(),l={id:a,faceId:t.id,targetId:i.id,faceUrl:t.remoteGetUrl,targetUrl:i.remoteGetUrl,type:i.type,status:"waiting",authToken:c};r.tasks.push(l);try{const u=yield r.api.initSwap(i.type,t.remoteGetUrl,i.remoteGetUrl,c,r.faceEnhance);if(1e5!==u.code)throw new Error(u.message);l.predictionId=u.data.prediction_id||u.data.request_id,r.saveAndPoll(l)}catch(u){console.error("Swap Initialization Failed:",u),l.status="failed",r.storage.set("tasks",l.id,l)}})()}saveAndPoll(t){this.storage.set("tasks",t.id,t),this.api.pollStatus(t.type,t.predictionId,t.authToken).pipe(function ot(o,n=!1){return(0,et.N)((s,t)=>{let i=0;s.subscribe((0,nt._)(t,r=>{const a=o(r,i++);(a||n)&&t.next(r),!a&&t.complete()}))})}(i=>"waiting"===i.data.status||0===i.data.status||"processing"===i.data.status,!0)).subscribe({next:i=>{"success"===i.data.status||i.data.result_img_url?(t.status="success",t.outputUrl=i.data.output||i.data.result_img_url,this.storage.set("tasks",t.id,t),this.isAutomationEnabled&&(console.log("Auto-downloading result for task:",t.id),this.directDownload(t))):"failed"===i.data.status&&(t.status="failed",this.storage.set("tasks",t.id,t))},error:i=>{console.error("Polling Error:",i),t.status="failed",this.storage.set("tasks",t.id,t)}})}restartPolling(){this.tasks.filter(t=>"waiting"===t.status&&t.predictionId).forEach(t=>this.saveAndPoll(t))}getMediaType(t){return t.includes("video")?"video":t.includes("gif")?"gif":"image"}removeMedia(t,i){var r=this;return(0,d.A)(function*(){yield r.storage.delete(i,t),"faces"===i?r.faces=r.faces.filter(c=>c.id!==t):r.targets=r.targets.filter(c=>c.id!==t);const a=r.tasks.filter(c=>"faces"===i?c.faceId===t:c.targetId===t);for(let c of a)yield r.storage.delete("tasks",c.id);r.tasks=r.tasks.filter(c=>"faces"===i?c.faceId!==t:c.targetId!==t)})()}directDownload(t){var i=this;return(0,d.A)(function*(){if(!t.outputUrl)return void i.presentToast("Output URL available nahi hai.","danger");const r=t.status;t.status="downloading";try{const a="image"===t.type?"png":"gif"===t.type?"gif":"mp4",c=`success_${Date.now()}.${a}`,l=yield fetch(t.outputUrl);if(!l.ok)throw new Error("Download failed");const u=yield l.blob(),m=window.URL.createObjectURL(u),y=document.createElement("a");y.href=m,y.download=c,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(m),t.status="downloaded",i.presentToast("File Downloaded!","success")}catch(a){console.error(a),t.status=r,i.presentToast("Download fail ho gaya.","danger")}yield i.storage.set("tasks",t.id,t)})()}presentToast(t){var i=this;return(0,d.A)(function*(r,a="medium"){(yield i.toastController.create({message:r,duration:3e3,color:a})).present()}).apply(this,arguments)}openUrl(t){console.log(this.tasks),window.open(t,"_blank")}deleteSingleTask(t){var i=this;return(0,d.A)(function*(){i.tasks=i.tasks.filter(r=>r.id!==t),yield i.storage.delete("tasks",t)})()}clearAllTasks(){var t=this;return(0,d.A)(function*(){confirm("Kya aap saare tasks aur target media delete karna chahte hain?")&&(t.tasks=[],t.targets=[],yield t.storage.clearStore("tasks"),yield t.storage.clearStore("targets"))})()}downloadAllTasks(){var t=this;return(0,d.A)(function*(){const i=t.tasks.filter(r=>"success"===r.status&&r.outputUrl);if(0!==i.length){t.presentToast(`${i.length} files download ho rahi hain...`,"primary");for(const r of i)yield t.directDownload(r),yield new Promise(a=>setTimeout(a,500))}else t.presentToast("Download karne ke liye koi successful task nahi hai.","warning")})()}isAllProcessing(){return 0===this.faces.length||0===this.targets.length||this.tasks.length>=this.faces.length*this.targets.length}retryTask(t){var i=this;return(0,d.A)(function*(){t.status="waiting",t.predictionId=void 0;try{i.presentToast("Retrying task...","primary");const r=yield i.api.initSwap(t.type,t.faceUrl,t.targetUrl,t.authToken,i.faceEnhance);if(1e5!==r.code)throw new Error("API Error");t.predictionId=r.data.prediction_id,i.saveAndPoll(t)}catch{t.status="failed",i.presentToast("Retry failed again.","danger")}yield i.storage.set("tasks",t.id,t)})()}static#t=o=()=>(this.\u0275fac=function(i){return new(i||n)(e.rXU(_t),e.rXU(Dt),e.rXU(f.K_))},this.\u0275cmp=e.VBU({type:n,selectors:[["app-home"]],standalone:!1,decls:49,vars:11,consts:[["color","primary"],["lines","inset"],["name","sparkles-outline","slot","start","color","primary"],["slot","end",3,"ngModelChange","ngModel"],["lines","none"],["name","flash-outline","slot","start","color","success"],[1,"ion-padding"],["type","file","multiple","","id","faceInput","hidden","",3,"change"],["onclick","document.getElementById('faceInput').click()"],["size","3",4,"ngFor","ngForOf"],["type","file","multiple","","id","targetInput","hidden","",3,"change"],["color","secondary","onclick","document.getElementById('targetInput').click()"],["name","cloud-upload-outline","slot","start"],["size","auto",4,"ngFor","ngForOf"],["expand","block",3,"click","disabled"],[4,"ngIf"],[1,"results-header-container"],[1,"results-title"],[1,"results-actions"],["fill","solid","size","small","color","primary",3,"click",4,"ngIf"],["fill","clear","color","danger","size","small",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["size","3"],[1,"media-box"],["color","danger","fill","clear",1,"delete-btn",3,"click"],["name","close-circle"],[3,"src"],["class","success-overlay",4,"ngIf"],["class","abs-center",4,"ngIf"],[1,"success-overlay"],["name","checkmark-circle","color","success"],[1,"abs-center"],["size","auto"],["fill","clear",1,"delete-btn",3,"click"],[3,"src",4,"ngIf"],["muted","",3,"src",4,"ngIf"],["class","abs-center","color","light",4,"ngIf"],["muted","",3,"src"],["color","light",1,"abs-center"],["fill","solid","size","small","color","primary",3,"click"],["name","cloud-download-outline","slot","start"],["fill","clear","color","danger","size","small",3,"click"],["name","trash-bin-outline"],["slot","start"],[3,"color"],["slot","end",1,"task-actions"],["fill","clear","color","warning",3,"click",4,"ngIf"],["fill","clear",3,"click",4,"ngIf"],["fill","clear","color","secondary",3,"click",4,"ngIf"],["fill","clear","color","danger",3,"click"],["name","trash-outline","slot","icon-only"],["name","crescent",4,"ngIf"],["fill","clear","color","warning",3,"click"],["name","sparkles-outline","slot","icon-only"],["fill","clear",3,"click"],["name","download-outline","slot","icon-only"],["fill","clear","color","secondary",3,"click"],["name","open-outline","slot","icon-only"],["name","crescent"]],template:function(i,r){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"AI Face Swap"),e.k0s()()(),e.j41(4,"ion-item",1),e.nrm(5,"ion-icon",2),e.j41(6,"ion-label")(7,"h2"),e.EFF(8,"Face Enhance"),e.k0s(),e.j41(9,"p"),e.EFF(10,"Improve output face quality (Takes more time)"),e.k0s()(),e.j41(11,"ion-toggle",3),e.mxI("ngModelChange",function(c){return e.DH7(r.faceEnhance,c)||(r.faceEnhance=c),c}),e.k0s()(),e.j41(12,"ion-item",4),e.nrm(13,"ion-icon",5),e.j41(14,"ion-label"),e.EFF(15,"Auto-Process & Download"),e.k0s(),e.j41(16,"ion-toggle",3),e.mxI("ngModelChange",function(c){return e.DH7(r.isAutomationEnabled,c)||(r.isAutomationEnabled=c),c}),e.k0s()(),e.j41(17,"ion-content")(18,"ion-list-header"),e.EFF(19,"Step 1: Choose Faces"),e.k0s(),e.j41(20,"div",6)(21,"input",7),e.bIt("change",function(c){return r.handleFileSelect(c,"faces")}),e.k0s(),e.j41(22,"ion-button",8),e.EFF(23,"Upload Faces"),e.k0s(),e.j41(24,"ion-grid")(25,"ion-row"),e.DNE(26,Ft,7,5,"ion-col",9),e.k0s()()(),e.j41(27,"ion-list-header"),e.EFF(28,"Step 2: Choose Target Videos/Images"),e.k0s(),e.j41(29,"div",6)(30,"input",10),e.bIt("change",function(c){return r.handleFileSelect(c,"targets")}),e.k0s(),e.j41(31,"ion-button",11),e.nrm(32,"ion-icon",12),e.EFF(33," Upload Targets "),e.k0s(),e.j41(34,"ion-grid")(35,"ion-row"),e.DNE(36,Gt,8,6,"ion-col",13),e.k0s()()(),e.j41(37,"ion-button",14),e.bIt("click",function(){return r.startSwapProcess()}),e.DNE(38,$t,2,1,"span",15)(39,Ht,2,0,"span",15)(40,Vt,2,0,"span",15),e.k0s(),e.j41(41,"div",16)(42,"ion-label",17),e.EFF(43,"Results"),e.k0s(),e.j41(44,"div",18),e.DNE(45,Lt,3,0,"ion-button",19)(46,Yt,2,0,"ion-button",20),e.k0s()(),e.j41(47,"ion-list"),e.DNE(48,Kt,18,10,"ion-item",21),e.k0s()()),2&i&&(e.R7$(11),e.R50("ngModel",r.faceEnhance),e.R7$(5),e.R50("ngModel",r.isAutomationEnabled),e.R7$(10),e.Y8G("ngForOf",r.faces),e.R7$(10),e.Y8G("ngForOf",r.targets),e.R7$(),e.Y8G("disabled",r.isAllProcessing()),e.R7$(),e.Y8G("ngIf",!r.isAllProcessing()),e.R7$(),e.Y8G("ngIf",r.isAllProcessing()&&r.tasks.length>0),e.R7$(),e.Y8G("ngIf",0===r.faces.length||0===r.targets.length),e.R7$(5),e.Y8G("ngIf",r.tasks.length>0),e.R7$(),e.Y8G("ngIf",r.tasks.length>0),e.R7$(2),e.Y8G("ngForOf",r.tasks))},dependencies:[v.Sq,v.bT,x.BC,x.vS,f.In,f.Jm,f.hU,f.W9,f.lO,f.eU,f.iq,f.uz,f.he,f.nf,f.AF,f.ln,f.w2,f.Zx,f.BC,f.BY,f.ai,f.hB,v.Pc],styles:["ion-col[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-start!important;align-items:center!important;padding:15px!important;min-width:120px!important;max-width:120px!important}.media-box[_ngcontent-%COMP%]{position:relative!important;width:100px!important;height:100px!important;border-radius:12px!important;border:3px solid transparent!important;background:#1e1e1e;display:block!important}.media-box.upload-success[_ngcontent-%COMP%]{border-color:#2dd36f!important}.media-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .media-box[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%!important;height:100%!important;object-fit:cover!important;display:block!important}.delete-btn[_ngcontent-%COMP%]{position:absolute!important;top:-10px!important;right:-10px!important;margin:0!important;z-index:100!important;height:28px!important;width:28px!important;--padding-start: 0 !important;--padding-end: 0 !important}.delete-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px!important;color:#eb445a!important;background:#fff!important;border-radius:50%!important;box-shadow:0 2px 5px #00000080}.success-overlay[_ngcontent-%COMP%]{position:absolute!important;top:5px!important;left:5px!important;z-index:50!important;background:#fff!important;border-radius:50%!important;height:20px!important;width:20px!important;display:flex!important;align-items:center!important;justify-content:center!important}.success-overlay[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px!important}ion-col[_ngcontent-%COMP%]{padding:5px!important;flex:0 0 auto!important;width:auto!important}.media-box[_ngcontent-%COMP%]{position:relative!important;width:90px!important;height:90px!important;margin:5px}.media-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .media-box[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%!important;height:100%!important;object-fit:cover;border-radius:8px}.delete-btn[_ngcontent-%COMP%]{position:absolute!important;top:-8px!important;right:-8px!important;margin:0!important;z-index:100!important;--padding-start: 0;--padding-end: 0;width:24px;height:24px}.delete-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;background:#fff;border-radius:50%}.task-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.task-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;height:32px}ion-thumbnail[_ngcontent-%COMP%]{--border-radius: 4px;border:1px solid #444}.results-header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:#f8f9fa;border-bottom:1px solid #ddd;margin-top:10px}.results-header-container[_ngcontent-%COMP%]   .results-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--ion-color-dark)}.results-header-container[_ngcontent-%COMP%]   .results-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.results-header-container[_ngcontent-%COMP%]   .results-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0;height:32px;font-size:12px;--border-radius: 6px}@media (prefers-color-scheme: dark){.results-header-container[_ngcontent-%COMP%]{background:#1e1e1e;border-bottom:1px solid #333}.results-header-container[_ngcontent-%COMP%]   .results-title[_ngcontent-%COMP%]{color:#fff}}"]}))}return o(),n})()}];let Qt=(()=>{var o;class n{static#t=o=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=e.$C({type:n}),this.\u0275inj=p.G2t({imports:[R.iI.forChild(Jt),R.iI]}))}return o(),n})(),Zt=(()=>{var o;class n{static#t=o=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=e.$C({type:n}),this.\u0275inj=p.G2t({imports:[v.MD,x.YN,f.bv,Qt]}))}return o(),n})()}}]);